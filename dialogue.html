<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "https://www.w3.org/TR/html4/strict.dtd">
<html>

<head>
    <meta http-equiv="Content-Type" content="text/html;charset=utf-8">
    <meta name="author" content="Prakash Prasad">
    <script type="text/javascript">

        var _gaq = _gaq || [];
        _gaq.push(['_setAccount', 'UA-27962903-1']);
        _gaq.push(['_setDomainName', 'prakashprasad.com']);
        _gaq.push(['_trackPageview']);

        (function () {
            var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
            ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
            var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
        })();

    </script>
    <link rel="Shortcut Icon" href="https://prakashprasad.com/images/favicon.ico" type="image/x-icon">
    <link
        href="https://fonts.googleapis.com/css?family=Open+Sans:300,400|Open+Sans+Condensed:300,300italic&subset=latin,greek,greek-ext,latin-ext"
        rel="stylesheet" type="text/css">
    <link href="main.css" rel="stylesheet" type="text/css">
    <link rel="stylesheet" type="text/css" href="menu_style.css">
    <link rel="stylesheet" href="Libraries/fancybox/jquery.fancybox-1.3.4.css" type="text/css" media="screen">
    <link type="text/css" rel="stylesheet" href="Libraries/syntaxhighlighter/styles/shCoreEclipse.css">

    <title>Dialogue Parser for Carioca game (C#) - prakashprasad.com</title>

    <script type="text/javascript" src="Libraries/jquery-1.4.3.min.js"></script>
    <script src="Libraries/fancybox/jquery.fancybox-1.3.4.js" type="text/javascript"></script>
    <script type="text/javascript" src="Libraries/jwplayer/jwplayer.js"></script>
    <script type="text/javascript" src="Libraries/syntaxhighlighter/scripts/shCore.js"></script>
    <script type="text/javascript" src="Libraries/syntaxhighlighter/scripts/shBrushCSharp.js"></script>
    <script type="text/javascript">	    SyntaxHighlighter.all();</script>
</head>

<body class="port-body">

    <a href="https://www.prakashprasad.com/blog" target="_blank">
        <div class="port-blog" style="left:55px; top:-5px; "></div>
    </a>

    <a href="https://photo.prakashprasad.com" target="_blank">
        <div class="port-photo" style="left:115px; top:-5px; "></div>
    </a>

    <div class="port-wrap">
        <div class="port-header" onclick="location.href='index.html';" style="cursor:pointer; "></div>

        <div class="nav-bar-container">
            <ul id="navigation-1">
                <li><a href="index.html" title="Home">Home</a></li>
                <li><a href="resume.html" title="Résumé">Résumé</a></li>
                <li><a href="projects.html" title="Projects" class="navigation-sel">Projects</a>
                    <ul class="navigation-2">
                        <li><a href="projects_as.html" title="Actionscript Projects">Actionscript</a></li>
                        <li><a href="projects_cpp.html" title="C++ Projects">C++</a></li>
                        <li><a href="projects_cs.html" title="C# Projects" class="navigation-sel">C#</a></li>
                        <li><a href="projects_java.html" title="Java Projects">Java</a></li>
                        <li><a href="projects_u3d.html" title="Unity 3D Projects">Unity 3D</a></li>
                        <li><a href="projects_u.html" title="Unrealscript Projects">Unrealscript</a></li>
                    </ul>
                </li>
                <li><a href="contact.html" title="Contact">Contact</a></li>
            </ul>
        </div>

        <div class="port-block" style="left:0; top:-36px; ">

            <h1>Dialogue Parser for Carioca game</h1>

            <h2>Description</h2>
            <div class="gamedescription">
                <p>As the Carioca game uses a SQLite database to store its generic conversation data, a tool had to be
                    designed so that XML file generated from FlameWind Conversation Editor could be imported for the
                    game. Each dialogue consisted of a statement followed by up to 4 choices. The application would use
                    the SQLite.NET library to push data to the table holding the dialogue tree structure. In addition,
                    each dialogue could have certain conditions that needed to be checked in-game as well as a set of
                    triggers that the game would execute in case of being selected.</p>
            </div>

            <h2>Features</h2>
            <div class="features">
                <ul>
                    <li>Support for FlameWind Dialogue XML file</li>
                    <li>Dialogue DOM parser</li>
                    <li>Uses SQLite.NET library</li>
                </ul>
            </div>

            <h2>Screenshots</h2>
            <div class="screenshots">

                <a rel="Gal-scbwai" title="Dialogue parser to read FlameWind XML file"
                    href="images/carioca/dialogueparser.png"><img border="0" alt=""
                        src="images/carioca/thumbs/dialogueparser_s.png"></a>
                <a rel="Gal-scbwai" title="After loading, stats are displayed about the dialogue"
                    href="images/carioca/dialogue_xml_loading.png"><img border="0" alt=""
                        src="images/carioca/thumbs/dialogue_xml_loading_s.png"></a>
                <a rel="Gal-scbwai" title="Datarows to be inserted into the SQLite db are previewed"
                    href="images/carioca/dialogue_xml_loaded.png"><img border="0" alt=""
                        src="images/carioca/thumbs/dialogue_xml_loaded_s.png"></a>

                <script type="text/javascript">
                    $(document).ready(function () {

                        $("a[rel=Gal-scbwai]").fancybox({
                            'transitionIn': 'elastic',
                            'transitionOut': 'fade',
                            'titlePosition': 'over',
                            'titleFormat': function (title, currentArray, currentIndex, currentOpts) {
                                return '<span id="fancybox-title-over">Image ' + (currentIndex + 1) + ' / ' + currentArray.length + (title.length ? ' &nbsp; ' + title : '') + '</span>';
                            }
                        });

                    });
                </script>

            </div>

            <h2>Code Sample</h2>
            <p style="margin-right:30px; margin-left:30px; ">While the dialogue parser is working through the XML file,
                it creates objects representative of the SQLite database's row structure. Once the reading process is
                finished, the data is loaded up into ADO.NET datasets and the SQLite.NET library saves it. This saving
                process is executed when the user decides that the data looks correct and presses the save button on the
                WinForm, which in turn executes the method shown here:</p>
            <div class="codeblock">
                <pre class="brush: csharp;">private void btnWriteDB_Click(object sender, EventArgs e)
{
    UpdateFormEnableState(false);

    if (mDBFile == string.Empty)
    {
        MessageBox.Show("No DB File to write data to.\r\nLoad a valid sqlite DB file first.");
        UpdateFormEnableState(true);
        return;
    }

    if (mXMLFile == string.Empty)
    {
        MessageBox.Show("No XML File to parse data from.\r\nLoad a valid Dialogue XML file first.");
        UpdateFormEnableState(true);
        return;
    }

    string connectionString = ConnectionStringSQLite;
    string commandText = string.Empty;
    switch (mNPCtype.ToLower())
    {
        case "druggie":
            commandText = "SELECT * FROM GAMEDIALOGUES_D WHERE 1=0";
            break;
        case "gangster":
            commandText = "SELECT * FROM GAMEDIALOGUES_G WHERE 1=0";
            break;
        default:
        case "civilian":
            commandText = "SELECT * FROM GAMEDIALOGUES_C WHERE 1=0";
            break;
    }

    helper = new dBHelper(connectionString);
    {
        if (helper.Load(commandText, "ID") == true)
        {
            for (int i = 0; i &lt; xml.ConversationList.Count; i++)
            {
                helper.DataSet.Tables[0].Rows.Add(helper.DataSet.Tables[0].NewRow());
                DataRow dataRow = helper.DataSet.Tables[0].Rows[i];

                dataRow["CONVERSATIONTEXT"] = ((DialogueEntry)xml.ConversationList[i]).ConversationText;
                dataRow["SPEAKER"] = ((DialogueEntry)xml.ConversationList[i]).DialogueSpeaker.ToString();
                dataRow["TRIGGERCONDITION"] = ((DialogueEntry)xml.ConversationList[i]).TriggerCondition;
                dataRow["TRIGGEREFFECT"] = ((DialogueEntry)xml.ConversationList[i]).TriggerEffect;
                dataRow["PREFABNUM"] = PrefabNum;
                dataRow["OPTION1"] = ((DialogueEntry)xml.ConversationList[i]).Option1;
                dataRow["OPTION2"] = ((DialogueEntry)xml.ConversationList[i]).Option2;
                dataRow["OPTION3"] = ((DialogueEntry)xml.ConversationList[i]).Option3;
                dataRow["OPTION4"] = ((DialogueEntry)xml.ConversationList[i]).Option4;
            }
            try
            {
                helper.Save();
                for (int i = 0; i &lt; xml.ConversationList.Count; i++)
                {
                    DataRow dataRow = helper.DataSet.Tables[0].Rows[i];
                    xml.UpdateDialogueIDs(((DialogueEntry)xml.ConversationList[i]).ID, Int32.Parse(dataRow["ID"].ToString()));
                }
                for (int i = 0; i &lt; xml.ConversationList.Count; i++)
                {
                    DataRow dataRow = helper.DataSet.Tables[0].Rows[i];

                    dataRow["OPTION1"] = xml.FindEntryWithID(Int32.Parse(dataRow["ID"].ToString())).Option1;
                    dataRow["OPTION2"] = xml.FindEntryWithID(Int32.Parse(dataRow["ID"].ToString())).Option2;
                    dataRow["OPTION3"] = xml.FindEntryWithID(Int32.Parse(dataRow["ID"].ToString())).Option3;
                    dataRow["OPTION4"] = xml.FindEntryWithID(Int32.Parse(dataRow["ID"].ToString())).Option4;
                }
                helper.Save();
            }
            catch (Exception ex)
            {
                MessageBox.Show("Error while inserting character start values !");
            }
        }
    }

    PrefabNum = -1;
    UpdateFormData();
    UpdateFormEnableState(true);
}
</pre>
            </div>

            <h2>Download</h2>
            <div class="downloads">
                <p>Click <a href="downloads/dialogue/DialogueParser.exe" class="red">here</a> to download the latest
                    version of application</p>
                <p><strong>Instructions:</strong></p>
                <ul>
                    <li>Download and run the application.</li>
                    <li>Dialogue class - This is the NPC class that the loaded XML has dialogues for
                        (Civilian/Druggie/Gangster/Cop/Kingpin).</li>
                    <li>Load XML File - Click this button and browse to the dialogue XML file's path. If the file has
                        valid dialogue, then after loading the application will show a summary of loaded dialogues as
                        well as a detailed listing in the application main window.</li>
                    <li>Load DB File - This button lets you select the target SQLite file where data will be stored for
                        Carioca game.</li>
                    <li>Write to DB - Clicking this button pushes data to the selected SQLite db file.</li>
                </ul>
            </div>

            <div class="emptygap">&nbsp;</div>

        </div>

        <div class="port-footer" style="left:0; top:-47px; ">Prakash Prasad © 2011 <strong><big>&middot;</big></strong>
            Copenhagen, Denmark <strong><big>&middot;</big></strong> Contact
            <script
                type="text/javascript">document.write('<a href="mailto:' + 'p' + 'r' + 'a' + 'k' + 'a' + 's' + 'h' + '@' + 'p' + 'r' + 'a' + 'k' + 'a' + 's' + 'h' + 'p' + 'r' + 'a' + 's' + 'a' + 'd' + '.' + 'c' + 'o' + 'm' + '" class="light" >' + 'p' + 'r' + 'a' + 'k' + 'a' + 's' + 'h' + '@' + 'p' + 'r' + 'a' + 'k' + 'a' + 's' + 'h' + 'p' + 'r' + 'a' + 's' + 'a' + 'd' + '.' + 'c' + 'o' + 'm' + '</a>');</script>
            for more details.
        </div>

    </div>

</body>

</html>